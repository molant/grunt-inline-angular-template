angular.module('statusieApp')
    .directive('feature', function () {
        return {
            template: '<section bindonce data-bo-class="feature.normalized_category" class="feature" data-ng-class="{\'show\' : show}" data-ng-show="feature.visible">    <header data-ng-click="expand()" class="feature-header" data-bo-title="feature.category">        <h1 data-bo-id="feature.normalized_name" class="feature_name" data-bo-text="feature.name"></h1>        <div class="feature-info">            <div class="ie-status" data-bo-if="feature.browsers.ie.prefixed || feature.browsers.ie.unprefixed" data-bo-text="\'IE\' + (feature.browsers.ie.prefixed || feature.browsers.ie.unprefixed) + \'+\'" data-bo-title="feature.statusDescription"></div>            <div class="ie-status" data-bo-if="!(feature.browsers.ie.prefixed || feature.browsers.ie.unprefixed)" data-bo-text="feature.position" data-bo-title="feature.statusDescription"></div>            <button class="collapsebtn"></button>        </div>    </header>    <div class="feature-body-wrapper">        <p data-bo-text="feature.summary"></p>        <p data-bo-if="feature.browsers.ie.prefixed">            <b>Prefixed version: </b> IE<span data-bo-text="feature.browsers.ie.prefixed"></span>        </p>        <p data-bo-if="feature.browsers.ie.unprefixed">            <b>Unprefixed version: </b> IE<span data-bo-text="feature.browsers.ie.unprefixed"></span>        </p>        <div class="feature-status-wrapper">            <ul class="feature_status browsers">                <li class="chrome" data-bo-class="{\'implemented\': feature.browsers.chrome.status === \'Shipped\' || feature.browsers.chrome.status === \'Prefixed\', \'indevelopment\' : feature.browsers.chrome.status === \'In Development\'}"                data-bo-title="feature.browsers.chrome.status + \' by Chrome\'">                    <a data-bo-if="feature.browsers.chrome.link" data-bo-href="feature.browsers.chrome.link" data-bo-text="feature.browsers.chrome.status + \' by Chrome\'"                    ></a>                    <span data-bo-if="!feature.browsers.chrome.link" data-bo-text="feature.browsers.chrome.status + \' by Chrome\'"></span>                </li>                <li class="firefox" data-bo-class="{\'implemented\': feature.browsers.firefox.status === \'Shipped\' || feature.browsers.firefox.status === \'Prefixed\', \'indevelopment\' : feature.browsers.firefox.status === \'In Development\'}"                 data-bo-title="feature.browsers.firefox.status + \' by Firefox\'">                    <a data-bo-if="feature.browsers.firefox.link" data-bo-href="feature.browsers.firefox.link" data-bo-text="feature.browsers.firefox.status + \' by Firefox\'"></a>                    <span data-bo-if="!feature.browsers.firefox.link" data-bo-text="feature.browsers.firefox.status + \' by Firefox\'"></span>                </li>                <li class="ie" data-bo-class="{\'implemented\': feature.browsers.ie.status === \'Shipped\' || feature.browsers.ie.status === \'Prefixed\', \'indevelopment\' : feature.browsers.ie.status === \'In Development\'}"                data-bo-title="feature.browsers.ie.status + \' by Internet Explorer\'">                    <a data-bo-if="feature.browsers.ie.link" data-bo-href="feature.browsers.ie.link" data-bo-text="feature.browsers.ie.status + \' by Internet Explorer\'"                     ></a>                    <span data-bo-if="!feature.browsers.ie.link" data-bo-text="feature.browsers.ie.status + \' by Internet Explorer\'"></span>                </li>                <li class="safari" data-bo-class="{\'implemented\': feature.browsers.safari.status === \'Shipped\' || feature.browsers.safari.status === \'Prefixed\', \'indevelopment\' : feature.browsers.safari.status === \'In Development\'}"                data-bo-title="feature.browsers.ie.status + \' by Safari\'">                    <a data-bo-if="feature.browsers.safari.link" data-bo-href="feature.browsers.safari.link " data-bo-text="feature.browsers.safari.status + \' by  Safari\'"></a>                    <span data-bo-if="!feature.browsers.safari.link" data-bo-text="feature.browsers.safari.status + \' by Safari\'"></span>                </li>            </ul>            <ul class="feature_status info">                <li data-bo-if="feature.docs.wpd" class="docs webplatform">                    <a data-bo-href="feature.docs.wpd" target="_blank">WebPlatform</a>                </li>                <li data-bo-if="feature.docs.msdn" class="docs msdn">                    <a data-bo-href="feature.docs.msdn" target="_blank">MSDN</a>                </li>                <li class="standard" data-bo-if="feature.spec.link" data-bo-class="feature.spec.organization">                    <a data-bo-href="feature.spec.link" target="_blank"                       data-bo-text="feature.spec.status"></a>                </li>                <!--<li class="demo" data-bo-if="feature.demo">-->                    <!--<a data-bo-href="feature.demos[0].link" target="_blank"-->                       <!--title="Demo" data-bo-text="feature.demos[0].title"></a>-->                <!--</li>-->            </ul>    </div>    </div></section>',
            restrict: 'E',
            replace: true,
            controller: function ($scope, $location) {
                'use strict';
                $scope.$on('filtersUpdated', function () {
                    $scope.show = false;
                });

                $scope.expand = function () {
                    $scope.show = !$scope.show;
                    if ($scope.show) {
                        $location.path('/' + $scope.feature.normalized_name);
                    }
                };

                var id = $location.path();
                if (id === '/' + $scope.feature.normalized_name) {
                    $scope.show = true;
                }
            }
        };
    });
